<!doctype html>
<html>
  <head>
  <meta charset="utf-8" />
  
  <title>Copy constructors and "explicit" in C++</title>
  
  <link href='http://fonts.googleapis.com/css?family=Crete+Round:400|Open+Sans:400,700|PT+Serif:400,700|Bubblegum+Sans' rel='stylesheet' type='text/css'>
  <link href="/css/reset.css" rel="stylesheet" media="screen" type="text/css" />
  <link href="/css/syntax.css" rel="stylesheet" media="screen" type="text/css" />
  <link href="/css/style.css" rel="stylesheet" media="screen" type="text/css" />
</head>

  <body>
    <div id="container">
      <div id="content">
        <h1>
          <a href="/blog/explicit-in-cpp">Copy constructors and "explicit" in C++</a>
          <small class="date">28 Sep 2011</small>
        </h1>
        <p>At one point you were probably told that something like:</p>
<div class='highlight'><pre><code class='cpp'><span class='kt'>int</span> <span class='n'>x</span><span class='p'>;</span>
<span class='n'>x</span> <span class='o'>=</span> <span class='mi'>4</span><span class='p'>;</span>
</code></pre>
</div>
<p>could be simplified to:</p>
<div class='highlight'><pre><code class='cpp'><span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>4</span><span class='p'>;</span>
</code></pre>
</div>
<p>While it&#8217;s true that both of these result in x having the value of 4, they&#8217;re sort of different things. The <code>=</code> operator is a little different in each case.</p>

<p>You may also have been told at one point that <code>int x = 4</code> could also be written as <code>int x(4)</code>. In fact this is what&#8217;s really going on when we do the initialization-assignment. It&#8217;s just syntactic sugar for invoking the copy constructor. This is different from first allocating an object, and then assigning its contents.</p>

<p>If you don&#8217;t believe me, trying running this code:</p>
<div class='highlight'><pre><code class='cpp'><span class='cp'>#include &lt;iostream&gt;</span>
<span class='k'>using</span> <span class='k'>namespace</span> <span class='n'>std</span><span class='p'>;</span>

<span class='k'>class</span> <span class='nc'>Foo</span>
<span class='p'>{</span>
  <span class='k'>public</span><span class='o'>:</span>
    <span class='n'>Foo</span><span class='p'>()</span> <span class='p'>{</span> <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;ctor&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span> <span class='p'>}</span>
    <span class='n'>Foo</span><span class='p'>(</span><span class='k'>const</span> <span class='n'>Foo</span><span class='o'>&amp;</span> <span class='n'>f</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;cctor&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span> <span class='p'>}</span>
    <span class='n'>Foo</span><span class='o'>&amp;</span> <span class='k'>operator</span><span class='o'>=</span><span class='p'>(</span><span class='k'>const</span> <span class='n'>Foo</span><span class='o'>&amp;</span> <span class='n'>f</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;op=&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span> <span class='p'>}</span>
<span class='p'>};</span>

<span class='kt'>int</span> <span class='n'>main</span><span class='p'>()</span>
<span class='p'>{</span>
  <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;Foo a;&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span>
  <span class='n'>Foo</span> <span class='n'>a</span><span class='p'>;</span>

  <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;</span><span class='se'>\n</span><span class='s'>Foo b; b = a;&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span>
  <span class='n'>Foo</span> <span class='n'>b</span><span class='p'>;</span>
  <span class='n'>b</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>;</span>

  <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;</span><span class='se'>\n</span><span class='s'>Foo c(a);&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span>
  <span class='n'>Foo</span> <span class='n'>c</span><span class='p'>(</span><span class='n'>a</span><span class='p'>);</span>

  <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;</span><span class='se'>\n</span><span class='s'>Foo d = a;&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span>
  <span class='n'>Foo</span> <span class='n'>d</span> <span class='o'>=</span> <span class='n'>a</span><span class='p'>;</span>

  <span class='k'>return</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>You&#8217;ll get this output:</p>
<div class='highlight'><pre><code class='text'>Foo a;
ctor

Foo b; b = a;
ctor
op=

Foo c(a);
cctor

Foo d = a;
cctor
</code></pre>
</div>
<p>If you think about it this makes sense - initialization and assignment are two different things. Initialization is about figuring out what to make memory look like when an object first springs into existence. Assignment is about taking an already created object and replacing its current data with new data.</p>

<p>Now, consider an expression like this:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>Foo</span> <span class='n'>f</span><span class='p'>(</span><span class='n'>v</span><span class='p'>);</span>
<span class='c1'>//or equivalently:</span>
<span class='n'>Foo</span> <span class='n'>f</span> <span class='o'>=</span> <span class='n'>v</span><span class='p'>;</span>
</code></pre>
</div>
<p>What type does <code>v</code> have in this context? In the code above <code>v</code> was a <code>Foo</code>, which made sense because we were invoking a copy constructor that expects a <code>Foo</code> as its only parameter. But it turns out that the type of <code>v</code> above doesn&#8217;t really matter &#8211; <em>any</em> <code>v</code> for which there is an appropriately defined <code>Foo</code> constructor will work:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>Foo</span><span class='p'>(</span><span class='kt'>int</span> <span class='n'>x</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;Foo(int)&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span> <span class='p'>}</span>

<span class='p'>...</span>

<span class='n'>Foo</span> <span class='n'>e</span> <span class='o'>=</span> <span class='mi'>4</span><span class='p'>;</span>
</code></pre>
</div>
<p>The above is perfectly valid. The <code>Foo e = 4</code> gets translated into <code>Foo e(4)</code>, which is a valid way of constructing a <code>Foo</code>. It actually also turns out that <code>Foo(int)</code> works like any copy constructor would:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>Foo</span> <span class='n'>do_stuff</span><span class='p'>(</span><span class='n'>Foo</span> <span class='n'>f</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='c1'>//stuff happens</span>
  <span class='k'>return</span> <span class='mi'>7</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='p'>...</span>

<span class='n'>Foo</span> <span class='n'>f</span> <span class='o'>=</span> <span class='n'>do_stuff</span><span class='p'>(</span><span class='mi'>17</span><span class='p'>);</span>
</code></pre>
</div>
<p>The copy constructor is used to pass <code>17</code> as a <code>Foo</code>, and again to return <code>7</code> as a <code>Foo</code>.</p>

<p>This is actually kind of neat. Imagine if we were writing a <code>BigInt</code> class. It might look something like this:</p>
<div class='highlight'><pre><code class='cpp'><span class='k'>class</span> <span class='nc'>BigInt</span>
<span class='p'>{</span>
  <span class='k'>public</span><span class='o'>:</span>
    <span class='n'>BigInt</span><span class='p'>()</span> <span class='p'>{</span> <span class='cm'>/*stuff*/</span> <span class='p'>}</span>
    <span class='n'>BigInt</span><span class='p'>(</span><span class='kt'>int</span> <span class='n'>x</span><span class='p'>)</span> <span class='p'>{</span> <span class='cm'>/*other stuff*/</span> <span class='p'>}</span>
    <span class='c1'>//some other public methods</span>
  <span class='k'>private</span><span class='o'>:</span>
    <span class='c1'>//magic instance data</span>
<span class='p'>};</span>
</code></pre>
</div>
<p>We can now create BigInts from ints really simply, like this:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>BigInt</span> <span class='n'>a</span> <span class='o'>=</span> <span class='mi'>42</span><span class='p'>;</span>
</code></pre>
</div>
<p>and also pass them to functions simply:</p>
<div class='highlight'><pre><code class='cpp'><span class='kt'>void</span> <span class='n'>stuff</span><span class='p'>(</span><span class='n'>BigInt</span> <span class='n'>x</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='c1'>//stuff</span>
<span class='p'>}</span>

<span class='p'>...</span>

<span class='n'>stuff</span><span class='p'>(</span><span class='mi'>73</span><span class='p'>);</span>         <span class='c1'>// &lt;- looks much nicer</span>
<span class='n'>stuff</span><span class='p'>(</span><span class='n'>BigInt</span><span class='p'>(</span><span class='mi'>73</span><span class='p'>));</span> <span class='c1'>// &lt;- than this</span>
</code></pre>
</div>
<p>That&#8217;s pretty convenient and allows for some nice syntax. But it can also be a bit of an issue. What if we were implementing some kind of container class:</p>
<div class='highlight'><pre><code class='cpp'><span class='k'>template</span><span class='o'>&lt;</span><span class='k'>class</span> <span class='nc'>T</span><span class='o'>&gt;</span>
<span class='k'>class</span> <span class='nc'>Container</span>
<span class='p'>{</span>
  <span class='k'>public</span><span class='o'>:</span>
    <span class='n'>Container</span><span class='p'>(</span><span class='kt'>int</span> <span class='n'>size</span><span class='p'>)</span> <span class='p'>{</span> <span class='cm'>/*stuff*/</span> <span class='p'>}</span>
    <span class='c1'>//etc</span>
  <span class='k'>private</span><span class='o'>:</span>
    <span class='c1'>//etc</span>
<span class='p'>};</span>
</code></pre>
</div>
<p>We can do this to make a container with room for 4 things:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>Container</span> <span class='n'>box</span><span class='p'>(</span><span class='mi'>4</span><span class='p'>);</span>
</code></pre>
</div>
<p>But we can also do this:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>Container</span> <span class='n'>box</span> <span class='o'>=</span> <span class='mi'>4</span><span class='p'>;</span>
</code></pre>
</div>
<p>That&#8217;s not so good. Unlike with BigInts, 4 is in no way a Container, and it&#8217;s misleading to use that kind of syntax. It can also get much more dangerous with things like this:</p>
<div class='highlight'><pre><code class='cpp'><span class='n'>T</span> <span class='n'>add</span><span class='p'>(</span><span class='n'>Container</span><span class='o'>&lt;</span><span class='n'>T</span><span class='o'>&gt;</span> <span class='n'>a</span><span class='p'>,</span> <span class='n'>Container</span><span class='o'>&lt;</span><span class='n'>t</span><span class='o'>&gt;</span> <span class='n'>b</span><span class='p'>)</span>
<span class='p'>{</span>
  <span class='c1'>//&quot;add&quot; the two containers</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>One might accidentally assume that <code>add(box,5)</code> is meant to add 5 to all the elements inside of <code>box</code>. Normally, the compiler would tell us that this is a type mis-match. But with the way we&#8217;ve defined our constructors, C++ will happily convert <code>5</code> into an empty container with room for 5 elements.</p>

<p>To fix this, we have the <code>explicit</code> keyword. Prefixing a constructor definition with <code>explicit</code> tells the compiler &#8220;don&#8217;t use this single-parameter constructor as a copy constructor&#8221;.</p>
<div class='highlight'><pre><code class='cpp'><span class='k'>explicit</span> <span class='n'>Foo</span><span class='p'>(</span><span class='kt'>int</span> <span class='n'>x</span><span class='p'>)</span> <span class='p'>{</span> <span class='n'>cout</span> <span class='o'>&lt;&lt;</span> <span class='s'>&quot;Foo(int)&quot;</span> <span class='o'>&lt;&lt;</span> <span class='n'>endl</span><span class='p'>;</span> <span class='p'>}</span>
</code></pre>
</div>
<p>Now, trying to do something like <code>Foo e = 4</code> will result in a compiler error.</p>
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="alecbenzer">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<!-- Place this tag where you want the +1 button to render -->
<g:plusone size="medium"></g:plusone>

<!-- Place this render call where appropriate -->
<script type="text/javascript">
  (function() {
   var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
   po.src = 'https://apis.google.com/js/plusone.js';
   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
   })();
 </script>
 <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'alecbenzer';
    var disqus_developer = 1;

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      <div id="footer">
  <p id="name"><a href="/">Alec Benzer</a></p>
  <p>Follow <a href="http://twitter.com/alecbenzer">@alecbenzer</a> on twitter.</p>
</div>

      <div id="back_to_index"><a href="/blog">&larr; home</a></div>
    </div>
  </body>
</html>
